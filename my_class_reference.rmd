---
title: "Class Reference"
author: "Leonardo Micheli"
output:
  html_document:
    theme: cerulean
    highlight: pygments
    toc: true
    toc_float:
      collapsed: true
      smooth_scroll: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introduction

Consider this a personal guide to the commands and functions you will learn. In general, when you come across an R command or function that you want to remember, put it in here along with a description of what it does and when you'd use it.

### How to set the working directory

The command to set a working directory is setwd(). For example, this sets the working directory to a directory called data_journalism_2024_fall inside a directory called jour472 located inside your home directory (the ~ is equivalent of /Users/[youruser] on a Mac).

```{r}
setwd("~/jour472/data_journalism_2024_fall")
```

### How to install and load the tidyverse

```{r}
install.packages("tidyverse")
library(tidyverse)

### How to load a file from the Internet:
   # inside read_rds() function, we’ve put the name of the file we want to load

maryland_winred_contributions <- read_rds("https://thescoop.org/files/maryland_winred.rds")

### How to have a first view of the file

glimpse(maryland_winred_contributions)
or
head(maryland_winred_contributions)

# take your data set and then do this specific action to it.
  data |> function

### How to count data 
### and how we want to group by data
  |> group_by(COLUMN NAME) |> 
    summarize(VARIABLE NAME = AGGREGATE
      FUNCTION(COLUMN NAME))
    e.g.:
maryland_winred_contributions |>
  group_by(memo_text) |>
  summarise(
    count_contribs = n()
  )

# How to count the number of rows or records in each group
    n()

### How to arrange data in order
    arrange()
maryland_winred_contributions |>
  group_by(memo_text) |>
  summarise(
    count_contribs = n()
  ) |>
  arrange(desc(count_contribs))

### How to know the total amount of a set of data
  We put the column we want to total – “amount” – inside the sum() function sum(amount)
  e.g.:
maryland_winred_contributions |>
  group_by(memo_text) |>
  summarise(
    count_contribs = n(),
    total_amount = sum(amount)
  ) |>
  arrange(desc(total_amount))
  
### How to calculate the average amount for each set of data - the mean - and the amount that sits at the midpoint of our data - the median.
maryland_winred_contributions |>
  group_by(memo_text) |>
  summarise(
    count_contribs = n(),
    total_amount = sum(amount),
    mean_amount = mean(amount),
    median_amount = median(amount)
  ) |>
  arrange(desc(count_contribs))

### How to calculate the highest and lowest set of data
 we can use the min() and max() functions.
e.g.:
 maryland_winred_contributions |>
  group_by(memo_text) |>
  summarise(
    count_contribs = n(),
    total_amount = sum(amount),
    mean_amount = mean(amount),
    median_amount = median(amount),
    min_amount = min(amount),
    max_amount = max(amount)
  ) |>
  arrange(desc(max_amount)) 

assignment 08/30 https://github.com/lmicheli21/data_journalism_2024_fall/commit/26e97ce97ae7a8720346ec501cb3b0c6573fa82e

# if you want to use a file is always on “”

# to create a new tab | if you want something else than the Tibble (temporary table)
  contribs_by_date <- maryland_winred_contributions |>
  group_by(date) |>
  summarise(
    count_contribs = n()
  ) |>
  arrange(desc(count_contribs))

  
# pre_lab_02
  1.  Review of first lab and questions/problems.
  2.  Review GitHub
  3.  Demonstration of mutate, filtering and dates

###  for making percentage
select() --> just show this columns
mutate() --> in it i can create things like percentages but also can improve data

**Selecting simply returns only the fields named**. So if you only want to see city and amount, you select those fields. When you look at your data again, you'll have two columns. If you try to use one of your columns that you had before you used select, you'll get an error. **Selecting works with columns. You will have the same number of records when you are done, but fewer columns of data to work with.**


e.g.,

primary_24 |>
  select(office_name, office_district, candidate_name, party, county_name, election_day, votes) |>
  mutate(
  percent_election_day = (election_day/votes)*100
)

# of this, we can make a better ordering? 
  just adding the arrange function

primary_24 |>
  select(office_name, office_district, candidate_name, party, county_name, election_day, votes) |>
  mutate(
  percent_election_day = (election_day/votes)*100
)  |> 
  arrange(desc(percent_election_day))
  
# mutate() also can improve data such as standardizing data - for example, making different spellings of, say, cities into a single one.
  --> You'll notice that there's a mix of styles: "Baltimore" and "BALTIMORE" for example. R will think those are two different cities, and that will mean that any aggregates we create based on city won't be accurate.
  Mutate - it's not just for math! And a function called `str_to_upper` that will convert a character column into all uppercase. Now we can say exactly how many donations came from Baltimore (I mean, of course, BALTIMORE).
  e.g.,
standardized_maryland_cities <- maryland_cities |>
  mutate(
    upper_city = str_to_upper(city)
)
  
# Mutate can make that happen by creating a new column and putting in a category value *based on the amount* of each record
  It starts out as a typical mutate statement, but case_when introduces some new things. Each line is basically a conditional filter followed by `~` and then a value for the new column for records that match that filter. 
  
### to filter
  **Filtering creates a subset of the data based on criteria**. All records where the amount is greater than 150,000. All records that match "College Park". Something like that. **Filtering works with rows -- when we filter, we get fewer rows back than we start with.**
e.g.,

prince_georges <- primary_24 |> filter(county_name == "Prince George's County")

head(prince_georges)

# We can then use our new `amount_category` column in group_by statements to make summarizing easier.
e.g.,
maryland_winred_categories |> 
  group_by(amount_category) |> 
  summarize(total_amount = sum(amount)) |> 
  arrange(desc(total_amount))

# AND - OR are boolean operators.
  AND is `&` and OR is `|`
  --> OR is additive; AND is restrictive
e.g.,
and_prince_georges <- primary_24 |> filter(county_name == "Prince George's County" & office_name == "U.S. Senator")

nrow(and_prince_georges)

## Dates
  often the format is `m/d/y`, and the lubridate function is called `mdy` that we can use with mutate:
e.g.,    
maryland_expenses <- maryland_expenses |> mutate(expenditure_date=mdy(expenditure_date))

head(maryland_expenses)

# , guess_max=10
what types the data  are for the (e.g.,) first 10. 

it might give this Warning: One or more parsing issues, call `problems()` on your data frame for details, e.g.:
  dat <- vroom(...)
--> to problem()
Can show that there might be values in a character column. 

# to find a specific data
texas_precinct_20 |> filter(election_day == "5+")

# case_when() not for all columns but only for some: with .default

texas_precinct_20 <- texas_precinct_20 |>
  mutate(election_day = case_when(
    election_day == '5+' ~ '49',
    .default = election_day
  ))

# to transform a character in a number, and vicersa:

texas_precinct_20 <- texas_precinct_20 |> mutate(election_day = as.numeric(election_day)) [or as.character()]

# first thing to do with dates is looking at they borders. 

# `clean_names()` 
#   rename(linenumber = x1_linenumber) change name of a column. 
  new name comes firts

#   get_dupes()
  show me the rows that are exactly duplicated. 
#   distinct() 
  it cleans duplicates. 
#str_sub() serves to standardize field, for instance, it converts the ZIP codes that have nine digits to five digits
    mutate(zip = str_sub(zip, start=1L, end=5L))
# str_detect
    mean "does this thing exist?"
    dc_food |>
  group_by(recipient_name) |>
  summarise(
    count=n()
  ) |>
  filter(str_detect(recipient_name, '^w|^W')) |> 
  arrange(recipient_name)
    
    
    
    